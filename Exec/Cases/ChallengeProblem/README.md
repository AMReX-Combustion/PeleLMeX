# ECP KPP challenge problem

This case is the ECP challenge problem, looking into the auto-ignition behavior of
a dual-fuel pulse into a representative piston-bowl geometry, in  realistic conditions.
The chamber is initially filled with a mixture of methane and air resulting from a
first port injection. Then injection of a diesel surrogate, n-dodecane, is triggered
and the simulation focuses on the ignition at the vicinity of these fuel jets.

## Geometry

The geometry is that of a simplified piston-bowl, scaled down by a factor 4. The scaled
cylinder is 24 mm in diameter and the piston head is generated by rotating a spline around 
the cylinder axis, resulting in a top volume 2.29 mm in height and extending in the piston
head by 3.92 mm. The geometry is generated within the EBUserDefined.H file.

## Chamber initial conditions

The initial conditions in the chamber are controled by the following parameters (SI units):
```
  prob.P_mean        = 6079500.0
  prob.T_mean        = 900.0
  prob.Y_CH4_chamber = 0.020594 
  prob.Y_O2_chamber  = 0.164305
```
with the remainder of the mixture made up of nitrogen. These default conditions correspond to a lean
mixture of CH4 in viciated air at an equivalence ratio of 0.5.

## Diesel injection

The second fuel is injected directly into the chamber and diesel is represented by a single component
surrogate: n-dodecane. The injection is controlled by the following parameters:

```
  prob.nholes             = 4
  prob.centx              = 0.0
  prob.centy              = 0.0
  prob.r_circ             = 0.0015
  prob.r_hole             = 0.000085
  prob.cone_angle         = 45.0
  prob.T_jet              = 470.0
  prob.vel_jet            = 28.0
  prob.Z                  = 0.45
  prob.injection_start    = 0.0
  prob.injection_duration = 0.0005
```

The injection plane is located on the z+ *xy*-plane, located ~10 mm downstream of the actual diesel nozzle.
It is assumed that the liquid jet is fully evaporated and partially mixed with entrained surrounded mixture.
This jet mixture composition is controlled by the *Z* parameters, defaulted to 45% of n-dodecane and 55% of
the initial chamber mixture.
The center of the injector is specified by *centx* and *centy*, with (0.0;0.0) being the center of the 
computational domain and the cylinder. On the z+ *xy*-plane, the jets of radius *r_hole* are distributed 
on a circle of radius *r_circ*, obtained by geometrically extruding from the diesel injector to the injection
plane with the jet angle specified by *cone_angle* (measured between the cylinder axis and the jet axis).
The temperature and velocoty of the jet, as well as the number of jets are controlled by *T_jet*, *vel_jet* and
*nholes*, respectively.
Finally, the timing and duration of the injector can be controlled.

## Running the KPP problem

To run this problem, the nodal projection needs to be performed with the Hypre library because the
EB geometry leads to linear system condition numbers that AMReX GMG is not able to handle.
In particular, one needs the preconditioning strategy recently developed by S. Thomas (https://arxiv.org/abs/2111.09512)
and currently implemented in the `IterTriSolve` branch of:
https://github.com/sthomas61/hypre.git

Once Hypre been compiled, one can turn on the use of Hypre in AMReX (USE_HYPRE=TRUE) and the provide the path to
the library using HYPRE_HOME in the GNUmakefile.

The turbulent jet boundary condition is read in from a precursor simulation stored into a 'TurbFile'. A single file is 
employed for all 4 jets, with a time offset allowing each jet to read in turbulent data shifted in time. The `TurbFile`
used for the KPP can be found on ORNL's Summit on the following location (shared CMB138 project directory):
/gpfs/alpine/proj-shared/cmb138/ECP_KPP/Turb.test2
